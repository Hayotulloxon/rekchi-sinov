<!doctype html>
<html lang="uz">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>RekchiAi olmoslari</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- VERSIYA O'ZGARGANDA KESHNI TOZALASH -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
</head>
<body style="background:black; color:white; text-align:center; padding:50px 20px;">
    
    <!-- STOP xabari -->
    <div id="stop-message">
        <h1 style="font-size:32px; color:red; margin-bottom:20px;">â›”</h1>
        <h2 style="font-size:24px; margin-bottom:10px;">Mini appdan chiqib kiring</h2>
        <p style="margin-bottom:30px; opacity:0.8;">Dastur vaqtincha yopildi</p>
        
        <button onclick="closeApp()" 
                style="padding:15px 30px; background:#0088cc; color:white; border:none; border-radius:10px; font-size:16px;">
            Chiqish
        </button>
    </div>
    
    <!-- Asosiy app (yashirin) -->
    <div id="main-app" style="display:none;">
        <!-- Bu yerda sizning asosiy app kodingiz -->
    </div>

<script>
// KESH VERSIYASI
const APP_VERSION = "1.0.2"; // BUNI HAR YANGI VERSIYADA O'ZGARTIRING!

// LocalStorage'dagi versiyani tekshirish
function checkVersion() {
    const savedVersion = localStorage.getItem('app_version');
    
    if (savedVersion !== APP_VERSION) {
        // Yangi versiya - keshni tozalash
        localStorage.clear();
        sessionStorage.clear();
        localStorage.setItem('app_version', APP_VERSION);
        
        // Sahifani yangilash
        location.reload();
        return false;
    }
    return true;
}

// Telegram Web Appni yopish
function closeApp() {
    if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.close();
    }
}

// GitHubdan tekshirish (KESHNI BYPASS)
async function checkGitHub() {
    try {
        // Timestamp qo'shamiz, har safar yangi URL bo'ladi
        const timestamp = Date.now();
        const response = await fetch(`https://yourgithub.github.io/stop.json?t=${timestamp}&v=${APP_VERSION}`);
        const data = await response.json();
        
        if (data.stop === true) {
            document.getElementById('stop-message').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
            
            // Her 10 soniyada GitHubni tekshirish
            setInterval(() => {
                fetch(`https://yourgithub.github.io/stop.json?t=${Date.now()}`)
                    .then(r => r.json())
                    .then(d => {
                        if (!d.stop) {
                            location.reload(); // stop=false bo'lsa yangilash
                        }
                    });
            }, 10000);
            
            return true;
        }
        return false;
    } catch (error) {
        return false;
    }
}

// APP YANGILASH TEKSHIRISH (har 60 soniyada)
function startAutoRefresh() {
    setInterval(async () => {
        try {
            const timestamp = Date.now();
            const response = await fetch(`https://yourgithub.github.io/stop.json?t=${timestamp}`);
            const data = await response.json();
            
            if (data.version && data.version !== APP_VERSION) {
                // Yangi versiya topildi
                localStorage.clear();
                location.reload();
            }
        } catch (e) {
            console.log("Versiya tekshirish xatosi");
        }
    }, 60000); // 60 soniyada bir
}

// Dasturni boshlash
async function startApp() {
    // 1. Versiyani tekshirish
    if (!checkVersion()) return;
    
    // 2. GitHubni tekshirish
    const stopped = await checkGitHub();
    
    // 3. Agar to'xtatilmagan bo'lsa
    if (!stopped) {
        document.getElementById('stop-message').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        
        // Sizning asosiy app kodingizni ishga tushiring
        console.log("App ishga tushdi");
        
        // Auto refreshni boshlash
        startAutoRefresh();
    }
}

// Sahifa yuklanganda boshlash
window.onload = startApp;

// SERVICE WORKER (agar kerak bo'lsa)
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
            registration.unregister();
        }
    });
}
</script>

</body>
</html>
