<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RekchiAi Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://static.sonartech.io/lib/1.0.0/sonar.js?appId=app_c5fa4840"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&family=Share+Tech+Mono&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Poppins', sans-serif;
            height: 100vh; overflow: hidden; color: #333;
            user-select: none;
        }
        
        .app-container {
            max-width: 450px; margin: 0 auto; height: 100vh; display: flex; flex-direction: column;
            background: white; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        /* Loader Style */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* HEADER */
        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            padding: 12px 15px; 
            border-bottom: 3px solid #ffd166; 
            z-index: 10;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
        }
        
        .balances-group {
            display: flex;
            gap: 6px;
            flex: 1;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .balances-group::-webkit-scrollbar { display: none; }
        
        .balance-item {
            background: rgba(255, 255, 255, 0.95); 
            padding: 8px 10px; 
            border-radius: 12px;
            font-weight: 800; 
            font-size: 13px; 
            border: 2px solid #ffd166;
            display: flex; align-items: center; justify-content: center;
            gap: 4px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex: 1;
            white-space: nowrap;
            min-width: fit-content;
        }
        
        .b-diamond { color: #ff6b6b; } 
        .b-coin { color: #ff8e53; }
        
        .small-decimal { font-size: 10px; opacity: 0.8; margin-left: 1px; font-weight: 600; }

        .header-actions {
            display: flex; gap: 5px; align-items: center;
        }

        .icon-btn-header {
            width: 42px; height: 42px; background: white; border-radius: 12px;
            border: 2px solid #ffd166; display: flex; align-items: center; justify-content: center;
            font-size: 18px; color: #ff6b6b; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: 0.1s; flex-shrink: 0;
        }
        .icon-btn-header:active { transform: scale(0.95); }

        /* MAIN CONTENT */
        .main-content { flex: 1; overflow-y: auto; padding: 20px; background: #f8f9fa; display: none; padding-bottom: 90px; }
        #servicesPage { display: block; } 
        
        .service-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        
        .service-btn {
            padding: 18px; border: none; border-radius: 20px; font-size: 16px; font-weight: 700;
            color: white; cursor: pointer; display: flex; align-items: center; gap: 15px; width: 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative; overflow: hidden;
            transition: transform 0.1s;
        }
        .service-btn:active { transform: scale(0.98); }
        .service-icon { font-size: 24px; width: 45px; height: 45px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        
        /* Colors */
        .instagram { background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045); }
        .telegram { background: linear-gradient(135deg, #0088cc, #34aadc); }
        .tiktok { background: linear-gradient(135deg, #000000, #25f4ee, #fe2c55); }
        .youtube { background: linear-gradient(135deg, #FF0000, #CC0000); }
        .game { background: linear-gradient(135deg, #9C27B0, #673AB7); }
        .special { background: linear-gradient(135deg, #FF9800, #FF5722); }

        /* Tabs */
        .tabs-container { display: flex; background: #eee; padding: 5px; border-radius: 15px; margin-bottom: 20px; gap: 5px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; border-radius: 12px; font-weight: 600; color: #666; cursor: pointer; transition: 0.3s; font-size: 13px; }
        .tab-btn.active { background: white; color: #ff6b6b; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* MINER CARDS */
        .miner-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        
        .miner-card { 
            background: #fff; border: 2px solid #eee; border-radius: 20px; padding: 15px 20px; 
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; 
            justify-content: space-between; position: relative; overflow: hidden;
        }
        .miner-card:active { transform: scale(0.98); background: #f9f9f9; }
        .miner-card.standard { border-color: #2196F3; }
        .miner-card.pro { border-color: #4CAF50; }
        .miner-card.ultra { border-color: #9C27B0; }
        .miner-card.dragon { border-color: #FF9800; background: #fffdf5; }
        
        .miner-left { display: flex; align-items: center; gap: 15px; }
        .miner-img { font-size: 32px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1)); }
        .miner-info { text-align: left; }
        .miner-name { font-weight: 800; font-size: 16px; color: #333; margin-bottom: 2px; }
        .miner-time { font-size: 12px; color: #888; font-weight: 500; }
        
        .miner-price { font-weight: 700; font-size: 14px; padding: 8px 15px; border-radius: 12px; white-space: nowrap; }
        .price-diamond { color: #ff6b6b; background: #ffebee; }
        .price-coin { color: #ff8e53; background: #fff3e0; }

        /* BANK CARD STYLE */
        .bank-card {
            background: linear-gradient(135deg, #1c1c1c 0%, #2c3e50 100%);
            border-radius: 20px;
            padding: 25px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            margin-bottom: 25px;
            cursor: pointer;
            transition: transform 0.2s;
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 140px; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .bank-card:active { transform: scale(0.98); }
        
        .bank-card-bg-icon {
            position: absolute;
            right: -20px;
            bottom: -20px;
            font-size: 120px;
            color: rgba(255,255,255,0.05);
            transform: rotate(-15deg);
            pointer-events: none;
        }

        .card-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-chip {
            width: 45px;
            height: 35px;
            background: linear-gradient(135deg, #d4af37 0%, #f2e3b6 50%, #d4af37 100%);
            border-radius: 6px;
            position: relative;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
        }
        .card-chip::before { content: ''; position: absolute; top: 12px; left: 0; width: 100%; height: 1px; background: rgba(0,0,0,0.3); }
        .card-chip::after { content: ''; position: absolute; top: 22px; left: 0; width: 100%; height: 1px; background: rgba(0,0,0,0.3); }

        .card-nfc { font-size: 24px; color: rgba(255,255,255,0.7); transform: rotate(90deg); }

        .card-balance-container {
            margin-top: 10px;
        }
        
        .card-balance-label { font-size: 12px; opacity: 0.7; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        
        .card-balance-value { 
            font-family: 'Share Tech Mono', monospace; 
            font-size: 28px; 
            letter-spacing: 1px; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .card-logo {
            position: absolute;
            bottom: 20px;
            right: 25px;
            font-size: 24px;
            opacity: 0.8;
            font-weight: 800; font-style: italic;
        }

        /* Active Miners List */
        .active-miner { 
            background: linear-gradient(135deg, #f6f8f9, #e5ebee); border: 1px solid #ccc; 
            border-radius: 12px; padding: 12px 15px; margin-bottom: 10px; 
            display: flex; justify-content: space-between; align-items: center; 
        }
        .active-miner-left { display: flex; align-items: center; gap: 12px; }
        .active-miner-icon { font-size: 24px; }
        .active-miner-name { font-weight: 800; font-size: 14px; text-transform: capitalize; color: #333; }
        .active-miner-status { font-size: 10px; color: #4CAF50; font-weight: 600; }
        .active-miner-timer { 
            font-weight: 700; font-family: monospace; font-size: 14px; 
            color: #fff; background: #0088cc; padding: 4px 8px; border-radius: 8px; 
        }

        /* Buttons & Inputs */
        .submit-btn { 
            width: 100%; padding: 15px; border: none; border-radius: 15px; 
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%); 
            color: white; font-weight: 800; font-size: 16px; cursor: pointer; 
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.4); margin-top: 10px;
        }
        .submit-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        .submit-btn:active { transform: scale(0.95); }
        .custom-input, .link-input { 
            width: 100%; padding: 14px; border: 2px solid #ffd166; border-radius: 12px; 
            margin-bottom: 15px; text-align: center; font-size: 16px; outline: none; background: #fff; 
        }

        /* Modals */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center;
            z-index: 1000; backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white; border-radius: 25px; padding: 25px; width: 90%; max-width: 380px;
            text-align: center; position: relative; border: 4px solid #ffd166;
            animation: popIn 0.3s ease; max-height: 90vh; overflow-y: auto;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .close-btn { position: absolute; top: 15px; right: 15px; background: #ff6b6b; color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; }

        /* Quantity Options */
        .quantity-options { display: grid; grid-template-columns: 1fr; gap: 10px; margin: 15px 0; }
        .quantity-btn { 
            padding: 15px; border: 2px solid #ffd166; background: white; border-radius: 12px; 
            font-weight: 700; font-size: 15px; cursor: pointer; transition: 0.2s; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .quantity-btn:active { background: #fff8e1; transform: scale(0.98); }

        /* Shop Styles */
        .shop-grid { display: grid; gap: 10px; margin-top: 10px; }
        .shop-item {
            background: #f8f9fa; padding: 15px; border-radius: 15px; border: 2px solid #eee;
            display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s;
        }
        .shop-item:active { transform: scale(0.98); border-color: #ff6b6b; }
        .shop-price { background: #ffd166; padding: 5px 10px; border-radius: 8px; font-weight: bold; font-size: 12px; }

        /* Navigation */
        .navigation {
            display: flex; background: white; height: 75px; border-top: 2px solid #ffd166;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); padding-bottom: 5px; position: absolute; bottom: 0; width: 100%; z-index: 20;
        }
        .nav-btn {
            flex: 1; border: none; background: none; display: flex; flex-direction: column;
            align-items: center; justify-content: center; color: #888; cursor: pointer; transition: 0.3s;
        }
        .nav-btn.active { color: #ff6b6b; }
        .nav-btn.active .nav-icon { transform: translateY(-3px); }
        .nav-icon { font-size: 24px; margin-bottom: 4px; }
        .nav-btn span { font-size: 10px; font-weight: 600; }

        /* Notification Toast */
        .notification { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-200%); 
            padding: 15px 25px; border-radius: 15px; background: #4CAF50; color: white; 
            font-weight: 600; z-index: 2000; transition: transform 0.5s; box-shadow: 0 10px 20px rgba(0,0,0,0.2); 
            display: flex; align-items: center; gap: 10px; min-width: 250px; justify-content: center;
        }
        .notification.error { background: #ff5252; }
        .notification.show { transform: translateX(-50%) translateY(0); }

        /* Loader */
        /* Loading Styles */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }

        .loading-text {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        /* Bigger loader for orders */
        .orders-loader {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }

        /* Skeleton Loading */
        .skeleton-order {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 15px;
            margin-bottom: 10px;
            height: 120px;
        }

        @keyframes loading {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Orders loader specific */
        #ordersList .loader {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 107, 107, 0.1);
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #ff6b6b; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Floating Elements */
        .floating-coins { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .coin { position: absolute; font-size: 24px; opacity: 0; animation: float 15s linear infinite; }
        @keyframes float { 0% { transform: translateY(110vh); opacity: 0; } 10% { opacity: 1; } 100% { transform: translateY(-10vh); opacity: 0; } }
        
        /* Admin Section Style */
        .adm-section {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 10px;
        }
        /* Balance Loading Animation */
        .balance-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 107, 107, 0.3);
            border-radius: 50%;
            border-top-color: #ff6b6b;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Admin Search Styles */
        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        .input-group .custom-input {
            margin-bottom: 0;
            flex: 1;
            text-align: left;
            padding-left: 15px;
        }
        .search-btn {
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 12px;
            width: 50px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .search-btn:active { transform: scale(0.95); }

        /* Admin Info Box */
        .user-info-box {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #0d47a1;
            text-align: left;
            display: none; 
        }

        /* Referral Item Style */
        .ref-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.2s;
        }
        .ref-item:last-child { border-bottom: none; }
        .ref-item:hover { background: #f9f9f9; }
        .ref-icon { color: #888; font-size: 14px; }
        .ref-name { font-weight: 700; color: #333; font-size: 14px; }
        
        /* Ad Settings Styles */
        .ad-settings-card {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #2196F3;
            margin-bottom: 15px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(33, 150, 243, 0.2);
        }
        
        .setting-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .setting-label {
            font-weight: 600;
            color: #1565C0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .setting-value {
            font-weight: 800;
            color: #0D47A1;
            font-size: 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-box {
            background: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 800;
            color: #2196F3;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .ad-progress {
            margin-top: 10px;
            background: #e0e0e0;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
        }
        
        .ad-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .ad-limit-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        /* Ad Status */
        .ad-status-card {
            background: white;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #ffd166;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .ad-status-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .ad-countdown {
            font-family: 'Share Tech Mono', monospace;
            font-size: 14px;
            color: #ff6b6b;
            font-weight: 700;
            margin-top: 5px;
        }

        /* PROMO CODE LIST */
        .promo-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 10px;
        }
        
        .promo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .promo-item:last-child {
            border-bottom: none;
        }
        
        .promo-info {
            flex: 1;
            text-align: left;
        }
        
        .promo-code {
            font-weight: bold;
            color: #333;
        }
        
        .promo-details {
            font-size: 12px;
            color: #666;
        }
        
        .delete-promo-btn {
            background: #ff4444;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .delete-promo-btn:active {
            transform: scale(0.95);
        }

        /* MY ORDERS STYLES */
        .orders-tab-container {
            display: flex;
            background: #eee;
            padding: 5px;
            border-radius: 15px;
            margin-bottom: 20px;
            gap: 5px;
        }
        
        .orders-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            border-radius: 12px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: 0.3s;
            font-size: 13px;
        }
        
        .orders-tab.active {
            background: white;
            color: #ff6b6b;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .order-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #f0f0f0;
            position: relative;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .order-id {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }
        
        .order-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-completed {
            background: #4CAF50;
            color: white;
        }
        
        .status-processing {
            background: #2196F3;
            color: white;
        }
        
        .status-pending {
            background: #FF9800;
            color: white;
        }
        
        .status-cancelled {
            background: #f44336;
            color: white;
        }
        
        .status-refunded {
            background: #9C27B0;
            color: white;
        }
        
        .order-details {
            text-align: left;
            margin-bottom: 10px;
        }
        
        .order-service {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .order-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .order-link {
            font-size: 12px;
            color: #0088cc;
            word-break: break-all;
        }
        
        .order-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .order-action-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .refill-btn {
            background: #4CAF50;
            color: white;
        }
        
        .cancel-btn {
            background: #f44336;
            color: white;
        }
        
        .no-orders {
            text-align: center;
            padding: 30px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="notification" id="notif"></div>
    <div class="floating-coins" id="floatingCoins"></div>

    <div class="app-container">
        <!-- HEADER -->
        <div class="header">
            <div class="header-content">
                <div class="balances-group">
                    <div class="balance-item b-diamond" id="uDiamond">üíé 0</div>
                    <div class="balance-item b-coin" id="uCoin">ü™ô 0.<span class="small-decimal">0000</span></div>
                </div>
                
                <div class="header-actions">
                    <button class="icon-btn-header" onclick="window.openShop()">
                        <i class="fas fa-shopping-cart"></i>
                    </button>
                    <button class="icon-btn-header" id="adminBtn" onclick="window.openAdmin()" style="display:none; background:#333; color:gold; border-color:gold;">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 1. SERVICES PAGE -->
        <div class="main-content page-content" id="servicesPage">
            <div class="service-grid">
                <button class="service-btn instagram" onclick="openModal('instagram-views')"><div class="service-icon" style="color:#E4405F"><i class="fab fa-instagram"></i></div><div class="service-text">Instagram Ko'rishlar</div></button>
                <button class="service-btn instagram" onclick="openModal('instagram-shares')"><div class="service-icon" style="color:#E4405F"><i class="fas fa-share-alt"></i></div><div class="service-text">Instagram Jo'natishlar</div></button>
                <button class="service-btn telegram" onclick="openModal('telegram-views')"><div class="service-icon" style="color:#0088cc"><i class="fab fa-telegram"></i></div><div class="service-text">Telegram Ko'rishlar</div></button>
                <button class="service-btn telegram" onclick="openModal('telegram-reactions')"><div class="service-icon" style="color:#0088cc"><i class="fas fa-heart"></i></div><div class="service-text">Telegram Reaksiya</div></button>
                <button class="service-btn tiktok" onclick="openModal('tiktok-views')"><div class="service-icon" style="color:#000"><i class="fab fa-tiktok"></i></div><div class="service-text">TikTok Ko'rishlar</div></button>
            </div>
        </div>

        <!-- 2. EARN PAGE -->
        <div class="main-content page-content" id="earnPage">
            <div class="tabs-container">
                <button class="tab-btn active" onclick="switchTab('earn', 'ads', this)">Reklama</button>
                <button class="tab-btn" onclick="switchTab('earn', 'promo', this)">Kod</button>
                <button class="tab-btn" onclick="switchTab('earn', 'ref', this)">Do'stlar</button>
            </div>

            <div id="earn-ads" class="earn-sec">
                <div class="ad-container" style="background:white; padding:25px; border-radius:20px; text-align:center;">
                    <div style="font-size:50px; margin-bottom:10px;">üì∫</div>
                    <p style="color:#666; margin-bottom:10px;">Reklama ko'rib olmos ishlang!</p>
                    
                    <div class="ad-status-card">
                        <div class="ad-status-icon" id="adStatusIcon">üìä</div>
                        <div style="font-weight:700; font-size:18px; margin-bottom:5px;" id="adStatusText">Tayyor</div>
                        <div class="ad-limit-info">
                            <span id="adViewsCount">0</span>
                            <span id="adLimitInfo">/ <span id="dailyLimitValue">10</span> ta</span>
                        </div>
                        <div class="ad-progress">
                            <div id="adProgressBar" class="ad-progress-bar" style="width:0%"></div>
                        </div>
                        <div class="ad-countdown" id="adCountdown"></div>
                    </div>
                    
                    <button class="submit-btn" id="watchAdBtn">Reklamani Ko'rish (+<span id="adBonusAmount">1</span> üíé)</button>
                </div>
            </div>

            <div id="earn-promo" class="earn-sec" style="display:none">
                <div class="ad-container" style="background:white; padding:25px; border-radius:20px;">
                    <h3 style="color:#ff6b6b; margin-bottom:10px;">Promokod</h3>
                    <input type="text" id="promoInput" class="custom-input" placeholder="CODE..." style="text-transform:uppercase">
                    <button class="submit-btn" onclick="activatePromo()">Ishlatish</button>
                </div>
            </div>

            <div id="earn-ref" class="earn-sec" style="display:none">
                <div class="ad-container" style="background:white; padding:25px; border-radius:20px;">
                    <h3 style="color:#0088cc; margin-bottom:10px;">Yangi do'stingiz sizni kodni promakod bo'limiga kiritsa: do'stingizga 5 üíé olmos, sizga 20 üíé olmos beriladi.</h3>
                    <div class="ref-box" style="background:#f0f4f8; padding:15px; border-radius:10px; border:2px dashed #0088cc; margin-bottom:15px; font-size:20px; font-weight:800;">
                        <span id="myRefCode">...</span>
                    </div>
                    <button class="submit-btn" onclick="copyRef()">Koddan Nusxa Olish</button>
                    <div id="refList" style="margin-top:15px; max-height:250px; overflow-y:auto; border:1px solid #eee; border-radius:10px;"></div>
                </div>
            </div>
        </div>

        <!-- 3. MINING PAGE -->
        <div class="main-content page-content" id="swapPage">
            <div class="tabs-container">
                <button class="tab-btn active" onclick="switchTab('mining', 'coin', this)">ü™ô Tanga Mayning</button>
                <button class="tab-btn" onclick="switchTab('mining', 'som', this)">üá∫üáø So'm Mayning</button>
            </div>

            <div id="mining-coin" class="mining-sec">
                <div class="miner-grid">
                    <div class="miner-card standard" onclick="buyMiner('standard')">
                        <div class="miner-left">
                            <div class="miner-img">üíª</div>
                            <div class="miner-info">
                                <div class="miner-name">Standart</div>
                                <div class="miner-time">Muddat: 24 soat</div>
                            </div>
                        </div>
                        <div class="miner-price price-diamond">50 üíé</div>
                    </div>
                    <div class="miner-card pro" onclick="buyMiner('pro')">
                        <div class="miner-left">
                            <div class="miner-img">üöÄ</div>
                            <div class="miner-info">
                                <div class="miner-name">Pro</div>
                                <div class="miner-time">Muddat: 24 soat</div>
                            </div>
                        </div>
                        <div class="miner-price price-diamond">100 üíé</div>
                    </div>
                    <div class="miner-card ultra" onclick="buyMiner('ultra')">
                        <div class="miner-left">
                            <div class="miner-img">‚ö°</div>
                            <div class="miner-info">
                                <div class="miner-name">Ultra</div>
                                <div class="miner-time">Muddat: 24 soat</div>
                            </div>
                        </div>
                        <div class="miner-price price-diamond">500 üíé</div>
                    </div>
                    <div class="miner-card dragon" onclick="buyMiner('dragon')">
                        <div class="miner-left">
                            <div class="miner-img">üê≤</div>
                            <div class="miner-info">
                                <div class="miner-name">Dragon</div>
                                <div class="miner-time">Muddat: 24 soat</div>
                            </div>
                        </div>
                        <div class="miner-price price-diamond">2000 üíé</div>
                    </div>
                </div>
            </div>

            <div id="mining-som" class="mining-sec" style="display:none">
                <div class="bank-card" onclick="openWithdraw()">
                    <i class="fas fa-wallet bank-card-bg-icon"></i>
                    
                    <div class="card-top">
                        <div class="card-chip"></div>
                        <i class="fas fa-wifi card-nfc"></i>
                    </div>
                    
                    <div class="card-balance-container">
                        <div class="card-balance-label">Sizning Balansingiz</div>
                        <div class="card-balance-value" id="pageSomBalance">0.<span class="small-decimal">0000</span> UZS</div>
                    </div>
                    
                    <div class="card-logo" style="bottom:15px; right:20px; font-weight:bold; font-style:italic;">WALLET</div>
                </div>

                <div class="miner-grid">
                    <div class="miner-card standard" onclick="buyMiner('kore')">
                        <div class="miner-left">
                            <div class="miner-img">üõ†</div>
                            <div class="miner-info">
                                <div class="miner-name">Kore</div>
                                <div class="miner-time">Muddat: 24 soat</div>
                            </div>
                        </div>
                        <div class="miner-price price-coin">100 ü™ô</div>
                    </div>
                    <div class="miner-card pro" onclick="buyMiner('power')">
                        <div class="miner-left">
                            <div class="miner-img">üîã</div>
                            <div class="miner-info">
                                <div class="miner-name">Power</div>
                                <div class="miner-time">Muddat: 24 soat</div>
                            </div>
                        </div>
                        <div class="miner-price price-coin">300 ü™ô</div>
                    </div>
                    <div class="miner-card ultra" onclick="buyMiner('turbo')">
                        <div class="miner-left">
                            <div class="miner-img">üèé</div>
                            <div class="miner-info">
                                <div class="miner-name">Turbo</div>
                                <div class="miner-time">Muddat: 24 soat</div>
                            </div>
                        </div>
                        <div class="miner-price price-coin">1000 ü™ô</div>
                    </div>
                    <div class="miner-card dragon" onclick="buyMiner('titan')">
                        <div class="miner-left">
                            <div class="miner-img">ü§ñ</div>
                            <div class="miner-info">
                                <div class="miner-name">Titan</div>
                                <div class="miner-time">Muddat: 24 soat</div>
                            </div>
                        </div>
                        <div class="miner-price price-coin">3000 ü™ô</div>
                    </div>
                </div>
            </div>

            <h3 style="margin:25px 0 10px 10px; font-size:15px; color:#333;">Faol Maynerlar</h3>
            <div id="activeMinersList"></div>
        </div>

        <!-- 4. PRO PAGE -->
        <div class="main-content page-content" id="proPage">
            <div class="service-grid">
                <button class="service-btn instagram" onclick="openModal('instagram-like')"><div class="service-icon" style="color:#E4405F"><i class="fas fa-heart"></i></div><div class="service-text">Instagram Like</div></button>
                <button class="service-btn instagram" onclick="openModal('instagram-followers')"><div class="service-icon" style="color:#E4405F"><i class="fas fa-users"></i></div><div class="service-text">Instagram Obunachi</div></button>
                <button class="service-btn instagram" onclick="openModal('instagram-story-like')"><div class="service-icon" style="color:#E4405F"><i class="fas fa-history"></i></div><div class="service-text">Instagram Storis Like</div></button>
                <button class="service-btn telegram" onclick="openModal('telegram-followers')"><div class="service-icon" style="color:#0088cc"><i class="fas fa-users"></i></div><div class="service-text">Telegram Obunachi</div></button>
                <button class="service-btn telegram" onclick="openModal('telegram-story-views')"><div class="service-icon" style="color:#0088cc"><i class="fas fa-eye"></i></div><div class="service-text">Telegram Storis Ko'rish</div></button>
                <button class="service-btn tiktok" onclick="openModal('tiktok-followers')"><div class="service-icon" style="color:#000"><i class="fas fa-users"></i></div><div class="service-text">TikTok Obunachi</div></button>
                <button class="service-btn tiktok" onclick="openModal('tiktok-like')"><div class="service-icon" style="color:#000"><i class="fas fa-heart"></i></div><div class="service-text">TikTok Like</div></button>
                <button class="service-btn youtube" onclick="openModal('youtube-like')"><div class="service-icon" style="color:#FF0000"><i class="fab fa-youtube"></i></div><div class="service-text">YouTube Like</div></button>
                
                <button class="service-btn special" onclick="openModal('telegram-stars')"><div class="service-icon" style="color:#FF9800"><i class="fas fa-star"></i></div><div class="service-text">Telegram Stars</div></button>
                <button class="service-btn special" onclick="openModal('telegram-gifts')"><div class="service-icon" style="color:#FF9800"><i class="fas fa-gift"></i></div><div class="service-text">Telegram Gifts</div></button>
                <button class="service-btn special" onclick="openModal('telegram-premium')"><div class="service-icon" style="color:#FF9800"><i class="fab fa-telegram"></i></div><div class="service-text">Telegram Premium</div></button>
                <button class="service-btn special" onclick="openModal('telegram-number')"><div class="service-icon" style="color:#FF9800"><i class="fas fa-phone"></i></div><div class="service-text">Telegram Raqam</div></button>
                <button class="service-btn game" onclick="openModal('pubg-donat')"><div class="service-icon" style="color:#9C27B0"><i class="fas fa-gamepad"></i></div><div class="service-text">PUBG 60 UC</div></button>
                <button class="service-btn game" onclick="openModal('freefire-donat')"><div class="service-icon" style="color:#9C27B0"><i class="fas fa-fire"></i></div><div class="service-text">FreeFire 110</div></button>
            </div>
        </div>

        <!-- 5. MY ORDERS PAGE -->
        <!-- 5. MY ORDERS PAGE -->
        <!-- 5. MY ORDERS PAGE -->
        <div class="main-content page-content" id="ordersPage">
            <div class="orders-tab-container">
                <button class="orders-tab active" onclick="switchOrdersTab('all', this)">Barchasi</button>
                <button class="orders-tab" onclick="switchOrdersTab('processing', this)">Bajarilmoqda</button>
                <button class="orders-tab" onclick="switchOrdersTab('completed', this)">Tugatilgan</button>
                <button class="orders-tab" onclick="switchOrdersTab('cancelled', this)">Bekor qilingan</button>
            </div>
            
            <!-- Loading container -->
            <div id="ordersLoading" class="loading-container" style="display: none;">
                <div class="loader"></div>
                <p class="loading-text">Buyurtmalar yuklanmoqda...</p>
            </div>
            
            <!-- Orders container -->
            <div id="ordersContainer">
                <div id="ordersList"></div>
            </div>
        </div>
        <!-- NAVIGATION -->
        <div class="navigation">
            <button class="nav-btn active" onclick="nav('servicesPage', this)"><div class="nav-icon"><i class="fas fa-rocket"></i></div><span>Xizmatlar</span></button>
            <button class="nav-btn" onclick="nav('earnPage', this)"><div class="nav-icon"><i class="fas fa-gem"></i></div><span>Ishlash</span></button>
            <button class="nav-btn" onclick="nav('swapPage', this)"><div class="nav-icon"><i class="fas fa-exchange-alt"></i></div><span>Mayning</span></button>
            <button class="nav-btn" onclick="nav('proPage', this)"><div class="nav-icon"><i class="fas fa-crown"></i></div><span>Pro</span></button>
            <button class="nav-btn" onclick="nav('ordersPage', this)"><div class="nav-icon"><i class="fas fa-clipboard-list"></i></div><span>Buyurtmalarim</span></button>
        </div>
    </div>

    <!-- MODALS -->
    
    <!-- Service Modal -->
    <div class="modal" id="mainModal">
        <div class="modal-content">
            <button class="close-btn" onclick="document.getElementById('mainModal').style.display='none'">√ó</button>
            <h3 id="modalTitle" style="margin-bottom:20px; color:#ff6b6b">Xizmat</h3>
            <div id="modalBody"></div>
            <div id="modalFooter" style="margin-top:10px;"></div>
            <div class="loader" id="loader"></div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div class="modal" id="shopModal">
        <div class="modal-content">
            <button class="close-btn" onclick="document.getElementById('shopModal').style.display='none'">√ó</button>
            <h3 style="margin-bottom:15px; color:#ff6b6b">Do'kon</h3>
            <div class="tabs-container">
                <button class="tab-btn active" onclick="setShop('diamond', this)">üíé Olmos</button>
                <button class="tab-btn" onclick="setShop('coin', this)">ü™ô Tanga</button>
            </div>
            <div id="shopList" class="shop-grid"></div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div class="modal" id="adminModal">
        <div class="modal-content">
            <button class="close-btn" onclick="document.getElementById('adminModal').style.display='none'">√ó</button>
            <h3 style="color:gold; margin-bottom:15px;">Admin Panel</h3>
            <div id="adminContent">
                <div class="tabs-container">
                    <button class="tab-btn active" onclick="switchAdminTab('promo', this)">Promo</button>
                    <button class="tab-btn" onclick="switchAdminTab('channel', this)">Kanal</button>
                    <button class="tab-btn" onclick="switchAdminTab('deduct', this)">Ayirish</button>
                    <button class="tab-btn" onclick="switchAdminTab('adsettings', this)">Reklama</button>
                </div>
                
                <div id="adm-promo" class="adm-section">
                    <input id="admCode" class="custom-input" placeholder="Kod nomi">
                    <input id="admAmt" type="number" class="custom-input" placeholder="Miqdor">
                    <select id="admType" class="custom-input"><option value="diamond">Olmos</option><option value="coin">Tanga</option></select>
                    <input id="admMax" type="number" class="custom-input" placeholder="Limit">
                    <button class="submit-btn" onclick="admAddPromo()">Yaratish</button>
                    
                    <div class="promo-list" id="adminPromoList"></div>
                </div>

                <div id="adm-channel" class="adm-section" style="display:none;">
                    <div id="admChanList" style="max-height:100px; overflow-y:auto; margin-bottom:10px; border:1px solid #eee;"></div>
                    <input id="admChanInput" class="custom-input" placeholder="@username">
                    <button class="submit-btn" onclick="admAddChan()">Qo'shish</button>
                </div>

                <div id="adm-deduct" class="adm-section" style="display:none;">
                    <h4 style="margin-bottom:10px; color:#333;">So'm Ayirish</h4>
                    
                    <div class="input-group">
                        <input id="admDedTarget" class="custom-input" placeholder="ID yoki Username (@siz)" style="margin-bottom:0;">
                        <button class="search-btn" onclick="admSearchUser()"><i class="fas fa-search"></i></button>
                    </div>
                    
                    <div id="admUserInfo" class="user-info-box"></div>

                    <input id="admDedAmount" type="number" class="custom-input" placeholder="Summa (so'm)">
                    <button class="submit-btn" style="background:red;" onclick="admDeductSom()">Ayirish</button>
                </div>
                
                <div id="adm-adsettings" class="adm-section" style="display:none;">
                    <h4 style="margin-bottom:15px; color:#333;">üìä Reklama Sozlamalari</h4>
                    
                    <div id="adSettingsContainer" style="margin-bottom:20px;"></div>
                    
                    <div class="ad-setting-form" style="margin-top:20px; padding-top:20px; border-top:2px dashed #4CAF50;">
                        <h5 style="color:#0088cc; margin-bottom:15px;">‚öôÔ∏è Sozlamalarni Yangilash</h5>
                        
                        <input type="number" id="adminAdBonus" class="custom-input" placeholder="Bonus miqdori (üíé)" min="1" max="100" value="1">
                        <input type="number" id="adminAdLimit" class="custom-input" placeholder="Kunlik limit (0 = cheksiz)" min="0" max="100" value="10">
                        <input type="number" id="adminAdCooldown" class="custom-input" placeholder="Cooldown (sekund, 0 = yo'q)" min="0" max="3600" value="0">
                        
                        <button class="submit-btn" style="background:#4CAF50; margin-top:15px;" onclick="saveAdSettings()">
                            <i class="fas fa-save"></i> Sozlamalarni Saqlash
                        </button>
                    </div>
                    
                    <div style="margin-top:25px; padding:15px; background:#f8f9fa; border-radius:12px;">
                        <h5 style="color:#9C27B0; margin-bottom:15px;">üìà Reklama Statistika</h5>
                        <div id="adStatsContainer" class="stats-grid"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <button class="close-btn" onclick="document.getElementById('withdrawModal').style.display='none'">√ó</button>
            <h3 style="color:#4CAF50; margin-bottom:15px;">Pul Yechish</h3>
            <p style="font-size:12px; color:#666;">Minimal: 10,000 UZS</p>
            <input type="number" id="wAmt" class="custom-input" placeholder="Summa">
            <button class="submit-btn" style="background:#4CAF50" onclick="withdraw()">Yechish (Admin)</button>
        </div>
    </div>

    <!-- Sub Modal -->
    <div class="modal" id="subModal" style="display:none; z-index:2000">
        <div class="modal-content">
            <h3 style="color:#ff6b6b; margin-bottom:10px;">Ilovadan foydalanish uchun kanalga obuna bo'ling va tekshirishni bosing :</h3>
            <div id="subList" style="text-align:center; margin-bottom:15px;"></div>
            <button class="submit-btn" onclick="checkSubs()" style="background:#4CAF50;">Tekshirish</button>
        </div>
    </div>

<script>
    const BACKEND_URL = 'https://68ed1ab05ca4e.myxvest1.ru/manage_balance.php'; 
    const ADMIN_URL = 'https://t.me/Sarvarxon_Anvarovich';
    const ADMIN_GIFT = 'https://t.me/behruz_aura';
    
    const tg = window.Telegram.WebApp;
    tg.expand();
    const userId = tg.initDataUnsafe?.user?.id || '123456789';
    const username = tg.initDataUnsafe?.user?.username || 'Guest';
    
    
    // TelegramAds ni ishga tushirish
    // TelegramAds ni ishga tushirish
    // TelegramAds ni ishga tushirish
    // TelegramAds ni ishga tushirish
    // TelegramAds ni ishga tushirish
    // TelegramAds ni ishga tushirish
    function initTelegramAds() {
        try {
            if (!window.TelegramAdsController) {
                console.warn('‚ùå TelegramAdsController script yuklanmadi');
                return;
            }
            
            console.log('‚úÖ TelegramAdsController topildi');
            
            // Konstruktor sifatida chaqirish
            if (typeof window.TelegramAdsController === 'function') {
                // Instance yaratish
                window.TelegramAdsController = new window.TelegramAdsController();
                
                // Initialize qilish
                window.TelegramAdsController.initialize({
                    pubId: "996799",
                    appId: "5842",
                    debug: false // Test uchun true qilishingiz mumkin
                });
                
                console.log('‚úÖ TelegramAds initialized');
                
                // triggerInterstitialBanner metodi borligini tekshirish
                if (typeof window.TelegramAdsController.triggerInterstitialBanner === 'function') {
                    console.log('‚úÖ triggerInterstitialBanner() metodi mavjud');
                } else {
                    console.warn('‚ö†Ô∏è triggerInterstitialBanner() metodi topilmadi');
                }
            }
        } catch (error) {
            console.error('‚ùå TelegramAds init xatosi:', error);
        }
    }
    
    // Sahifa yuklanganda
    window.addEventListener('load', function() {
        // TelegramAds scriptini kutish
        setTimeout(() => {
            initTelegramAds();
        }, 2000);
    });
    let user = { d: 0, c: 0, s: 0, ref: '' };
    let curService = null;
    let selQty = 0;
    let selPrice = 0;
    let shopType = 'diamond';
    let activeMinersList = [];
    let adSettings = { bonus_amount: 1, daily_limit: 10 };
    let adStats = { today_views: 0, daily_limit: 10 };
    let adLimitResetTime = null;
    let cooldownTimer = null;
    let cooldownRemaining = 0;
    const MINER_INFO = {
        'standard': { type: 'c', rate: 12 / 86400, icon: 'üíª' },
        'pro':      { type: 'c', rate: 25 / 86400, icon: 'üöÄ' },
        'ultra':    { type: 'c', rate: 130 / 86400, icon: '‚ö°' },
        'dragon':   { type: 'c', rate: 550 / 86400, icon: 'üê≤' },
        'kore':     { type: 's', rate: 3000 / 86400, icon: 'üõ†' },
        'power':    { type: 's', rate: 9000 / 86400, icon: 'üîã' },
        'turbo':    { type: 's', rate: 30000 / 86400, icon: 'üèé' },
        'titan':    { type: 's', rate: 90000 / 86400, icon: 'ü§ñ' }
    };

    const services = {
        'instagram-views': { 
            name: 'Instagram Ko\'rishlar', id: 278, min: 1000, price: 0.025, 
            packages: [ { qty: 1000, price: 25 },{ qty: 2000, price: 50 }, { qty: 5000, price: 125 }, { qty: 10000, price: 250 } ], currency: 'diamond', placeholder: 'Post Linki' },
        'instagram-shares': { name: 'Instagram Jo\'natishlar', id: 292, min: 10, price: 0.14, packages: [ { qty: 20, price: 3 }, { qty: 50, price: 7 }, { qty: 100, price: 14 } ], currency: 'diamond', placeholder: 'Post Linki' },
        'telegram-views': { name: 'Telegram Ko\'rishlar', id: 58, min: 100, price: 0.025, packages: [ { qty: 200, price: 5 }, { qty: 500, price: 13 }, { qty: 1000, price: 25 } ], currency: 'diamond', placeholder: 'Post Linki' },
        'telegram-reactions': { name: 'Telegram Reaksiya', id: 74, min: 10, price: 0.2, packages: [ { qty: 10, price: 2 }, { qty: 20, price: 4 }, { qty: 50, price: 10 } ], currency: 'diamond', placeholder: 'Post Linki' },
        'tiktok-views': { name: 'TikTok Ko\'rishlar', id: 410, min: 100, price: 0.025, packages: [ { qty: 200, price: 5 }, { qty: 500, price: 13 }, { qty: 1000, price: 25 } ], currency: 'diamond', placeholder: 'Video Linki' },
        
        'instagram-like': { name: 'Instagram Like', id: 577, min: 10, price: 0.2, packages: [ { qty: 10, price: 2 }, { qty: 20, price: 4 }, { qty: 50, price: 10 }, { qty: 100, price: 20 } ], currency: 'coin', placeholder: 'Post Linki' },
        'instagram-followers': { name: 'Instagram Obunachi', id: 218, min: 10, price: 0.8, packages: [ { qty: 10, price: 8 }, { qty: 20, price: 16 }, { qty: 50, price: 40 }, { qty: 100, price: 80 } ], currency: 'coin', placeholder: 'Username' },
        'instagram-story-like': { name: 'Instagram Storis Like', id: 1158, min: 10, price: 0.2, packages: [ { qty: 10, price: 2 }, { qty: 20, price: 4 }, { qty: 50, price: 10 }, { qty: 100, price: 20 } ], currency: 'coin', placeholder: 'Story Link' },
        'telegram-followers': { name: 'Telegram Obunachi', id: 1477, min: 500, price: 0.8, packages: [ { qty: 500, price: 400 }, { qty: 600, price: 480 }, { qty: 700, price: 560 }, { qty: 800, price: 640 } ], currency: 'coin', placeholder: 'Kanal Linki' },
        'telegram-story-views': { name: 'Telegram Storis Ko\'rish', id: 1115, min: 10, price: 0.1, packages: [ { qty: 10, price: 1 }, { qty: 20, price: 2 }, { qty: 50, price: 5 }, { qty: 100, price: 10 } ], currency: 'coin', placeholder: 'Story Link' },
        'tiktok-followers': { name: 'TikTok Obunachi', id: 1420, min: 10, price: 0.8, packages: [ { qty: 10, price: 8 }, { qty: 20, price: 16 }, { qty: 50, price: 40 }, { qty: 100, price: 80 } ], currency: 'coin', placeholder: 'Profil Linki' },
        'tiktok-like': { name: 'TikTok Like', id: 1470, min: 20, price: 0.05, packages: [ { qty: 20, price: 1 }, { qty: 40, price: 2 }, { qty: 100, price: 5 }, { qty: 500, price: 25 } ], currency: 'coin', placeholder: 'Video Linki' },
        'youtube-like': { name: 'YouTube Like', id: 1498, min: 10, price: 0.2, packages: [ { qty: 10, price: 2 }, { qty: 20, price: 4 }, { qty: 50, price: 10 }, { qty: 100, price: 20 } ], currency: 'coin', placeholder: 'Video Linki' },
        'telegram-stars': { name: 'Telegram Stars', id: 467, min: 50, price: 5, packages: [ { qty: 50, price: 250 }, { qty: 100, price: 500 }, { qty: 150, price: 750 } ], currency: 'coin', placeholder: 'Username' },
        
        'telegram-premium': { name: 'Telegram Premium', price: 1125, type: 'admin', currency: 'coin', link: ADMIN_URL, msg: 'Premium kerak' },
        'telegram-gifts': { name: 'Telegram Gifts', price: 99, type: 'admin', currency: 'coin', link: ADMIN_GIFT, msg: 'Gifts kerak' },
        'telegram-number': { name: 'Telegram Raqam', price: 399, type: 'admin', currency: 'coin', link: ADMIN_URL, msg: 'Raqam kerak' },
        'pubg-donat': { name: 'Pubg 60 UC', price: 325, type: 'admin', currency: 'coin', link: ADMIN_URL, msg: 'Assalomu aleykum PUBG 60 UC kerak Narxi:325 tanga' },
        'freefire-donat': { name: 'FreeFire 110 almaz', price: 375, type: 'admin', currency: 'coin', link: ADMIN_URL, msg: 'Assalomu aleykum FreeFire 110 Almaz kerak Narxi:375 tanga' }
    };

    async function api(action, data = {}) {
        try {
            let body = { action, user_id: userId, username: username, ...data };
            let headers = {'Content-Type': 'application/json', 'X-Telegram-Data': tg.initData };
            body.key = '4564123:hkjhfadfhieapkdnga';
            let req = await fetch(BACKEND_URL, { method: 'POST', headers, body: JSON.stringify(body) });
            return await req.json();
        } catch (e) { return { success: false, message: 'Internet xatosi' }; }
    }

    async function updateAdStatus() {
        // Earn sahifasi ochiq emasligini tekshirish
        let earnPage = document.getElementById('earnPage');
        if (!earnPage || earnPage.style.display === 'none') {
            return; // Earn sahifasi yopiq bo'lsa, hech narsa qilmaslik
        }
        
        try {
            let res = await api('check_ad_limit');
            
            if(res.success) {
                let total_today = parseInt(res.today_views) || 0;
                let total_limit = parseInt(res.daily_limit) || 10;
                let bonus_amount = parseInt(res.bonus_amount) || 1;
                let is_unlimited = res.is_unlimited || false;
                let cooldown_seconds = parseInt(res.cooldown_seconds) || 0;
                cooldownRemaining = parseInt(res.cooldown_remaining) || 0;
                let can_watch = res.can_watch !== false;
                
                let adsgram_views = parseInt(res.adsgram_views) || 0;
                let sonar_views = parseInt(res.sonar_views) || 0;
                let telegramads_views = parseInt(res.telegramads_views) || 0;
                let next_platform = res.next_platform || '';
                
                // Elementlarni olish (null check bilan)
                let progressBar = document.getElementById('adProgressBar');
                let viewsCount = document.getElementById('adViewsCount');
                let limitValue = document.getElementById('dailyLimitValue');
                let limitInfo = document.getElementById('adLimitInfo');
                let bonusAmountEl = document.getElementById('adBonusAmount');
                let btn = document.getElementById('watchAdBtn');
                let statusIcon = document.getElementById('adStatusIcon');
                let statusText = document.getElementById('adStatusText');
                
                // Agar elementlar topilmasa, return
                if (!progressBar || !viewsCount || !bonusAmountEl || !btn || !statusIcon || !statusText) {
                    return;
                }
                
                // Progress va limit ko'rsatkichlarini yangilash
                if (is_unlimited) {
                    progressBar.style.width = '0%';
                    viewsCount.textContent = total_today;
                    if (limitValue) limitValue.textContent = '‚àû';
                    if (limitInfo) limitInfo.innerHTML = '';
                } else {
                    let progressPercent = (total_today / total_limit) * 100;
                    progressPercent = Math.min(progressPercent, 100);
                    
                    progressBar.style.width = progressPercent + '%';
                    viewsCount.textContent = total_today;
                    if (limitValue) limitValue.textContent = total_limit;
                    if (limitInfo) limitInfo.innerHTML = `/ <span id="dailyLimitValue">${total_limit}</span> ta`;
                }
                
                bonusAmountEl.textContent = bonus_amount;
                
                // Cooldown holatida
                if (cooldownRemaining > 0) {
                    btn.disabled = true;
                    btn.innerHTML = `<i class="fas fa-hourglass-half"></i> Kutish: ${cooldownRemaining}s`;
                    btn.style.background = 'linear-gradient(135deg, #FF9800, #F57C00)';
                    startCooldownTimer();
                    statusIcon.textContent = '‚è±Ô∏è';
                    statusText.textContent = `Kutish: ${cooldownRemaining}s`;
                    statusText.style.color = '#FF9800';
                }
                // Limit tugagan
                else if(!is_unlimited && total_today >= total_limit) {
                    btn.disabled = true;
                    btn.innerHTML = `<i class="fas fa-lock"></i> Limit Tugadi`;
                    btn.style.background = 'linear-gradient(135deg, #ccc, #999)';
                    statusIcon.textContent = '‚è∞';
                    statusText.textContent = 'Limit tugadi';
                    statusText.style.color = '#f44336';
                }
                // Reklama ko'rish mumkin
                else {
                    btn.disabled = false;
                    btn.innerHTML = `Reklamani Ko'rish (+${bonus_amount} üíé)`;
                    btn.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%)';
                    statusIcon.textContent = 'üìä';
                    
                    if (is_unlimited) {
                        statusText.textContent = 'Cheksiz reklama';
                        statusText.style.color = '#4CAF50';
                    } else {
                        statusText.textContent = `${total_limit - total_today} ta reklama qoldi`;
                        statusText.style.color = '#4CAF50';
                    }
                }
                
                updateCountdownTimer();
            }
        } catch(e) {
            console.error('Ad status error:', e);
        }
    }
    function updateCooldownButton() {
        let btn = document.getElementById('watchAdBtn');
        if (!btn) return;
        
        if (cooldownRemaining > 0) {
            btn.disabled = true;
            btn.innerHTML = `<i class="fas fa-hourglass-half"></i> Kutish: ${cooldownRemaining}s`;
            btn.style.background = 'linear-gradient(135deg, #FF9800, #F57C00)';
        } else {
            btn.disabled = false;
        }
    }
    
    function startCooldownTimer() {
        // Avvalgi timerni to'xtatish
        if (cooldownTimer) {
            clearInterval(cooldownTimer);
            cooldownTimer = null;
        }
        
        // Agar cooldown 0 bo'lsa, timer ishlatmaslik
        if (cooldownRemaining <= 0) {
            return;
        }
        
        cooldownTimer = setInterval(() => {
            if (cooldownRemaining > 0) {
                cooldownRemaining--;
                
                // Tugma va status matnini yangilash
                let btn = document.getElementById('watchAdBtn');
                let statusText = document.getElementById('adStatusText');
                
                if (btn) {
                    btn.innerHTML = `<i class="fas fa-hourglass-half"></i> Kutish: ${cooldownRemaining}s`;
                }
                
                if (statusText) {
                    statusText.textContent = `Kutish: ${cooldownRemaining}s`;
                }
            } else {
                // Cooldown tugaganda
                clearInterval(cooldownTimer);
                cooldownTimer = null;
                updateAdStatus(); // Status yangilash
            }
        }, 1000);
    }
    function updateCountdownTimer() {
        let countdownEl = document.getElementById('adCountdown');
        if (!countdownEl) return;
        
        // Earn sahifasi ochiq emasligini tekshirish
        let earnPage = document.getElementById('earnPage');
        if (!earnPage || earnPage.style.display === 'none') {
            return;
        }
        
        let now = new Date();
        let tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0);
        
        let timeLeft = tomorrow - now;
        let hours = Math.floor(timeLeft / (1000 * 60 * 60));
        let minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        let seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        let timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        countdownEl.textContent = `Limit yangilanadi: ${timeString}`;
        
        if (timeLeft < 1000) location.reload();
    }

    async function fetchBalance() {
        // Loading ko'rsatish
        document.getElementById('uDiamond').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        document.getElementById('uCoin').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        
        let res = await api('get_balance');
        if(res.success) {
            user.d = parseInt(res.diamonds); 
            user.c = parseFloat(res.coins); 
            user.s = parseFloat(res.som_balance); 
            user.ref = res.referral_code;
            updateUI();
            
            if(res.is_admin === 1) {
                document.getElementById('adminBtn').style.display = 'flex';
            }
        } else {
            // Xato holatida standart qiymatlar
            document.getElementById('uDiamond').innerText = 'üíé 0';
            document.getElementById('uCoin').innerHTML = 'ü™ô 0.<span class="small-decimal">0000</span>';
        }
    }

    function updateUI() {
        document.getElementById('uDiamond').innerText = `üíé ${user.d}`;
        let cStr = user.c.toFixed(4).split('.');
        document.getElementById('uCoin').innerHTML = `ü™ô ${cStr[0]}.<span class="small-decimal">${cStr[1]}</span>`;
        let sStr = user.s.toFixed(4).split('.');
        document.getElementById('pageSomBalance').innerHTML = `${sStr[0]}.<span class="small-decimal">${sStr[1]}</span> UZS`;
        
        document.getElementById('myRefCode').innerText = user.ref;
    }

    function startMiningSimulation() {
        activeMinersList.forEach(m => {
            if(m.time_left > 0) {
                let info = MINER_INFO[m.type];
                if(info) {
                    let step = info.rate / 10;
                    if(info.type === 'c') user.c += step;
                    if(info.type === 's') user.s += step;
                }
            }
        });
        updateUI();
    }

    function startMinerTimer() {
        if(activeMinersList.length > 0) {
            let html = '';
            activeMinersList.forEach(m => {
                if(m.time_left > 0) m.time_left--;
                let info = MINER_INFO[m.type] || { icon: '‚ùì' };
                let tStr = m.time_left > 0 ? new Date(m.time_left * 1000).toISOString().substr(11, 8) : "Tugadi";

                html += `
                <div class="active-miner">
                    <div class="active-miner-left">
                        <span class="active-miner-icon">${info.icon}</span>
                        <div>
                            <div class="active-miner-name">${m.type}</div>
                            <div class="active-miner-status">Ishlamoqda...</div>
                        </div>
                    </div>
                    <div class="active-miner-timer">${tStr}</div>
                </div>`;
            });
            document.getElementById('activeMinersList').innerHTML = html;
        } else {
             document.getElementById('activeMinersList').innerHTML = '<p style="text-align:center; color:#999; padding:10px;">Faol mayner yo\'q</p>';
        }
    }

    async function loadMiners() {
        let res = await api('get_miners');
        if(res.success) { 
            activeMinersList = res.miners; 
            startMinerTimer();
        }
    }

    async function buyMiner(type) {
        if(!confirm(type.toUpperCase() + " sotib olasizmi?")) return;
        let res = await api('buy_miner', {miner_type: type});
        notif(res.success, res.message);
        if(res.success) {
            fetchBalance();
            loadMiners();
        }
    }

    window.nav = (page, btn) => {
        document.querySelectorAll('.page-content').forEach(e => e.style.display='none');
        document.getElementById(page).style.display='block';
        document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
        btn.classList.add('active');
        
        // Har bir sahifaga o'z funksiyasini chaqirish
        if(page === 'swapPage') {
            loadMiners();
        }
        else if(page === 'earnPage') {
            updateAdStatus(); // Faqat Earn sahifasida chaqirish
        }
        else if(page === 'ordersPage') {
            loadMyOrders();
        }
    };

    window.switchTab = (grp, target, btn) => {
        document.querySelectorAll(`.${grp}-sec`).forEach(e => e.style.display='none');
        document.getElementById(`${grp}-${target}`).style.display='block';
        btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Agar earn-ads tabiga o'tilsa, ad status'ni yangilash
        if (grp === 'earn' && target === 'ads') {
            updateAdStatus();
        }
    };

    window.switchOrdersTab = (type, btn) => {
        // Barcha tablardan active klassini olib tashlash
        btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        // Joriy tabga active klassini qo'shish
        btn.classList.add('active');
        
        // Buyurtmalarni filtrlash
        loadMyOrders(type);
    };
    function translateStatus(status) {
        const translations = {
            'completed': 'Bajarildi',
            'processing': 'Bajarilmoqda',
            'pending': 'Kutilmoqda',
            'cancelled': 'Bekor qilingan',
            'refunded': 'Qaytarilgan',
            'in progress': 'Bajarilmoqda',
            'partial': 'Qisman bajarildi'
        };
        return translations[status] || status;
    }

    // Skeleton loading ko'rsatish
    function showSkeletonLoading(count = 3) {
        let html = '';
        for (let i = 0; i < count; i++) {
            html += `
            <div class="skeleton-order"></div>
            `;
        }
        document.getElementById('ordersList').innerHTML = html;
    }

    // Buyurtmalarni yuklash funksiyasi
    async function loadMyOrders(filter = 'all') {
        // Loading ko'rsatish
        let container = document.getElementById('ordersList');
        container.innerHTML = `
        <div style="display:flex; flex-direction:column; align-items:center; padding:50px 20px;">
            <div class="loader" style="width:40px; height:40px;"></div>
            <p style="margin-top:15px; color:#666; font-size:14px;">Buyurtmalar yuklanmoqda...</p>
        </div>`;
        
        let res = await api('get_my_orders', {filter: filter});
        if(res.debug) {
            console.log('DEBUG INFO:', res.debug);
        }
        if(res.success && res.orders && res.orders.length > 0) {
            let html = '';
            res.orders.forEach(order => {
                // Statusni o'zbek tiliga tarjima qilish
                let originalStatus = order.status.toLowerCase(); // Kichik harfga o'tkazish
                let statusText = translateStatus(originalStatus);
                
                // Status klassini aniqlash (asl status bo'yicha)
                let statusClass = '';
                if (originalStatus === 'completed' || originalStatus === 'bajarildi') {
                    statusClass = 'status-completed';
                    statusText = 'Bajarildi';
                } else if (originalStatus === 'processing' || originalStatus === 'in progress' || originalStatus === 'bajarilmoqda') {
                    statusClass = 'status-processing';
                    statusText = 'Bajarilmoqda';
                } else if (originalStatus === 'pending' || originalStatus === 'kutilmoqda') {
                    statusClass = 'status-pending';
                    statusText = 'Bajarilmoqda';
                } else if (originalStatus === 'canceled' || originalStatus === 'bekor qilingan') {
                    statusClass = 'status-cancelled';
                    statusText = 'Bekor qilingan';
                } else if (originalStatus === 'refunded' || originalStatus === 'qaytarilgan') {
                    statusClass = 'status-refunded';
                    statusText = 'Qaytarilgan';
                } else if (originalStatus === 'partial' || originalStatus === 'qisman bajarildi') {
                    statusClass = 'status-pending';
                    statusText = 'Qisman bajarildi';
                } else {
                    statusClass = 'status-pending';
                    statusText = originalStatus;
                }
                
                // Valyuta belgisi
                let currencySymbol = '';
                if (order.currency === 'diamond' || order.currency === 'diamonds') {
                    currencySymbol = 'üíé';
                } else if (order.currency === 'coin' || order.currency === 'coins') {
                    currencySymbol = 'ü™ô';
                } else {
                    currencySymbol = order.currency || '';
                }
                
                // Linkni qisqartirish (agar uzun bo'lsa)
                let displayLink = order.link || '';
                let fullLink = displayLink;
                if (displayLink.length > 50) {
                    displayLink = displayLink.substring(0, 50) + '...';
                }
                
                // Sana formati
                let displayDate = order.created_at || '';
                if (displayDate) {
                    try {
                        let date = new Date(displayDate);
                        if (!isNaN(date.getTime())) {
                            displayDate = date.toLocaleDateString('uz-UZ', {
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        }
                    } catch (e) {
                        // Xatolik bo'lsa, asl sanani saqlash
                    }
                }
                
                html += `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-id">Buyurtma #${order.id}</div>
                        <div class="order-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="order-details">
                        <div class="order-service">${order.service_name || 'Noma\'lum xizmat'}</div>
                        <div class="order-meta">
                            <span>Miqdor: ${order.quantity || 0} ta</span>
                            <span>Narx: ${order.price || 0} ${currencySymbol}</span>
                        </div>
                        <div class="order-meta">
                            <span>Sana: ${displayDate}</span>
                            <span>Buyurtma ID: ${order.api_order_id || '-'}</span>
                        </div>
                        ${fullLink ? `<div class="order-link" title="${fullLink}">Havola: ${displayLink}</div>` : ''}
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        } else {
            container.innerHTML = `
            <div class="no-orders">
                <i class="fas fa-inbox" style="font-size:40px; margin-bottom:10px; color:#ccc;"></i>
                <p style="color:#999; font-size:14px;">Hozircha buyurtmalar yo'q</p>
                <p style="color:#666; font-size:12px; margin-top:10px;">Xizmatlardan foydalanish uchun "Xizmatlar" bo'limiga o'ting</p>
            </div>`;
        }
    }
    async function refillOrder(orderId) {
        let res = await api('refill_order', {order_id: orderId});
        notif(res.success, res.message);
        if(res.success) loadMyOrders();
    }

    async function cancelOrder(orderId) {
        if(!confirm('Buyurtmani bekor qilishni tasdiqlaysizmi?')) return;
        let res = await api('cancel_order', {order_id: orderId});
        notif(res.success, res.message);
        if(res.success) loadMyOrders();
    }

    window.switchAdminTab = (target, btn) => {
        document.querySelectorAll('.adm-section').forEach(e => e.style.display='none');
        document.getElementById(`adm-${target}`).style.display='block';
        btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if(target === 'promo') loadAdminPromoCodes();
    };

    window.openModal = (key) => {
        curService = services[key];
        if(!curService) return;
        
        let m = document.getElementById('mainModal');
        let b = document.getElementById('modalBody');
        let f = document.getElementById('modalFooter');
        let l = document.getElementById('loader');

        m.style.display = 'flex';
        b.style.display = 'block';
        f.style.display = 'block';
        l.style.display = 'none';

        document.getElementById('modalTitle').innerText = (curService.name || key).toUpperCase();
        f.innerHTML = '';

        if(curService.type === 'admin') {
            b.innerHTML = `
                <div style="background:#fff3e0; padding:15px; border-radius:10px; color:#e65100; font-weight:bold; margin-bottom:10px;">
                    Narxi: ${curService.price} ü™ô
                </div>
            `;
            f.innerHTML = `<button class="submit-btn" onclick="buyAdmin()">Sotib Olish</button>`;
        } else {
            let symbol = curService.currency === 'diamond' ? 'üíé' : 'ü™ô';
            let html = `<div class="quantity-options">`;
            
            if(curService.packages) {
                curService.packages.forEach(pkg => {
                    html += `
                    <div class="quantity-btn" onclick="selQtyFunc(${pkg.qty}, ${pkg.price})">
                        <span>${pkg.qty} ta</span>
                        <span style="color:${symbol === 'üíé' ? '#ff6b6b' : '#ff8e53'}">${pkg.price} ${symbol}</span>
                    </div>`;
                });
            }
            html += `</div>
            <button class="quantity-btn" style="width:100%; justify-content:center;" onclick="customQty()">Boshqa miqdor</button>`;
            
            b.innerHTML = html;
        }
    };

    window.selQtyFunc = (q, p) => { selQty = q; selPrice = p; askLink(); };
    
    window.customQty = () => {
        let b = document.getElementById('modalBody');
        b.innerHTML = `
            <p>Miqdor (Min: ${curService.min})</p>
            <input type="number" class="custom-input" placeholder="0" oninput="calcPrice(this.value)">
            <div id="pricePreview" style="font-weight:bold; color:#ff6b6b; margin-top:10px;"></div>
        `;
        document.getElementById('modalFooter').innerHTML = `<button id="custBtn" class="submit-btn" disabled onclick="askLink()">Davom etish</button>`;
    };

    window.calcPrice = (val) => {
        let q = parseInt(val);
        let btn = document.getElementById('custBtn');
        if(!q || q < curService.min) {
            document.getElementById('pricePreview').innerText = `Min: ${curService.min}`;
            btn.disabled = true;
            return;
        }
        let p = Math.ceil(q * curService.price);
        let sym = curService.currency === 'diamond' ? 'üíé' : 'ü™ô';
        selQty = q; selPrice = p;
        document.getElementById('pricePreview').innerText = `Narxi: ${p} ${sym}`;
        btn.disabled = false;
        btn.innerText = `Davom etish (${p} ${sym})`;
    };

    window.askLink = () => {
        let bal = curService.currency === 'diamond' ? user.d : user.c;
        if(bal < selPrice) { notif(false, 'Mablag\' yetarli emas'); return; }
        
        document.getElementById('modalBody').innerHTML = `
            <div style="font-weight:bold; margin-bottom:10px;">Buyurtma: ${selQty} ta</div>
            <input type="text" id="targetLink" class="custom-input" placeholder="${curService.placeholder}">
        `;
        document.getElementById('modalFooter').innerHTML = `<button class="submit-btn" onclick="submitOrder(this)">Buyurtma Berish</button>`;
    };

    async function submitOrder(btn) {
        let link = document.getElementById('targetLink').value.trim();
        if(!link) return notif(false, 'Iltimos, havolani kiriting');
        
        if(curService.id === 467 && !link.includes('@') && !link.startsWith('http')) link = '@' + link;
        else if(curService.id !== 218 && curService.id !== 467 && !link.startsWith('http')) link = link;
    
        btn.disabled = true;
        document.getElementById('modalBody').style.display = 'none';
        document.getElementById('modalFooter').style.display = 'none';
        document.getElementById('loader').style.display = 'block';
    
        try {
            let res = await api('order', {
                service_id: curService.id, 
                service_name: curService.name,
                link: link, 
                quantity: selQty, 
                price: selPrice, 
                currency: curService.currency
            });
            
            document.getElementById('loader').style.display = 'none';
            
            if(res.success) {
                notif(true, '‚úÖ Buyurtma muvaffaqiyatli qabul qilindi!');
                document.getElementById('mainModal').style.display = 'none';
                fetchBalance();
                loadMyOrders();
            } else {
                let errorMessage = res.message || 'Noma\'lum xatolik yuz berdi';
                
                if (errorMessage.includes('duplicate') || errorMessage.includes('qaytarildi') || errorMessage.includes('faol')) {
                    errorMessage = '‚ö†Ô∏è Sizda bu havola bo\'yicha faol buyurtma mavjud. Iltimos, bir necha daqiqadan keyin urinib ko\'ring yoki boshqa havola kiriting.';
                } else if (errorMessage.includes('not enough') || errorMessage.includes('yetarli')) {
                    errorMessage = '‚ùå Balansingizda yetarli mablag\' mavjud emas. Iltimos, balansingizni to\'ldiring.';
                } else if (errorMessage.includes('invalid') || errorMessage.includes('link')) {
                    errorMessage = '‚ùå Noto\'g\'ri havola formati. Iltimos, to\'g\'ri havola kiriting.';
                } else if (errorMessage.includes('minimum') || errorMessage.includes('minimal')) {
                    errorMessage = '‚ùå Minimal miqdor: ' + curService.min;
                } else errorMessage = '‚ùå Xatolik: ' + errorMessage;
                
                notif(false, errorMessage);
                document.getElementById('modalBody').style.display = 'block';
                document.getElementById('modalFooter').style.display = 'block';
                btn.disabled = false;
            }
        } catch (error) {
            document.getElementById('loader').style.display = 'none';
            notif(false, 'üåê Internet aloqasi xatosi. Iltimos, internetingizni tekshiring.');
            document.getElementById('modalBody').style.display = 'block';
            document.getElementById('modalFooter').style.display = 'block';
            btn.disabled = false;
        }
    }

    async function buyAdmin() {
        if(user.c < curService.price) return notif(false, 'Tanga yetarli emas');
        let msg = `${curService.msg}\n(ID: ${userId}, Balans: ${user.c})`;
        window.open(`${curService.link}?text=${encodeURIComponent(msg)}`, '_blank');
        document.getElementById('mainModal').style.display='none';
    }

    window.openShop = () => {
        document.getElementById('shopModal').style.display='flex';
        setShop('diamond', document.querySelector('.tab-btn'));
    };

    window.setShop = (type, btn) => {
        shopType = type;
        if(btn) {
            btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        
        let pkgs = type === 'diamond' ? 
            [{a:500, p:21000}, {a:1000, p:39000}, {a:2000, p:75000}, {a:3000, p:99000}] : 
            [{a:500, p:26000}, {a:1000, p:51000}, {a:2000, p:99000}, {a:3000, p:120000}];
        
        let sym = type === 'diamond' ? 'üíé' : 'ü™ô';
        let html = '';
        pkgs.forEach(pkg => {
            html += `
            <div class="shop-item" onclick="buyPkg(${pkg.a}, ${pkg.p}, '${sym}')">
                <div style="font-weight:bold; color:#333;">${pkg.a} ${sym}</div>
                <div class="shop-price">${pkg.p.toLocaleString()} so'm</div>
            </div>`;
        });
        document.getElementById('shopList').innerHTML = html;
    };

    window.buyPkg = (a, p, s) => {
        let msg = `Assalomu aleykum, ${a} ${s}. sotib olmoqchiman ${p.toLocaleString()} so'm.`;
        window.open(`${ADMIN_GIFT}?text=${encodeURIComponent(msg)}`, '_blank');
    };

    window.openWithdraw = () => { document.getElementById('withdrawModal').style.display='flex'; };
    async function withdraw() {
        let amt = document.getElementById('wAmt').value;
        if(!amt) return notif(false, 'Summa kiritilmadi');
        let res = await api('withdraw', {amount: amt});
        notif(res.success, res.message);
        if(res.success) {
            fetchBalance();
            document.getElementById('withdrawModal').style.display='none';
            window.open(`${ADMIN_GIFT}?text=${encodeURIComponent("Pul yechish so'rovi: " + amt + " so'm.")}`, '_blank');
        }
    }

    async function admSearchUser() {
        let t = document.getElementById('admDedTarget').value;
        if(!t) return notif(false, 'ID yoki Username kiriting');
        
        let res = await api('admin_get_user_info', { target: t });
        
        if(res.success) {
            let div = document.getElementById('admUserInfo');
            div.style.display = 'block';
            div.innerHTML = `Topildi: <b>${res.username}</b><br>Balans: <span style="color:green; font-weight:bold">${res.som_balance} so'm</span>`;
        } else notif(false, 'Foydalanuvchi topilmadi');
    }

    async function admDeductSom() {
        let target = document.getElementById('admDedTarget').value;
        let amount = document.getElementById('admDedAmount').value;
        if(!target || !amount) return notif(false, 'Ma\'lumot yetarli emas');
        
        let res = await api('admin_deduct_som', { target: target, amount: amount });
        if(res.success) {
            notif(true, 'Balansdan muvaffaqiyatli ayrildi');
            document.getElementById('admDedAmount').value = '';
            document.getElementById('admUserInfo').style.display = 'none';
        } else notif(false, res.message);
    }

    const AdController = window.Adsgram?.init({ blockId: "21365" });

    // Global o'zgaruvchi - qaysi platformadan boshlamoqchi ekanligimizni saqlash
    let currentAdAttempt = 0;
    
    document.getElementById('watchAdBtn').onclick = async () => {
        // Cooldown holatida faqat return qilish
        if (cooldownRemaining > 0) {
            return;
        }
        
        // Avval limitni tekshirish
        let limitCheck = await api('check_ad_limit');
        
        if(!limitCheck.success) {
            notif(false, limitCheck.message);
            return;
        }
        
        // Cooldown tekshiruvi
        if (limitCheck.cooldown_remaining > 0) {
            cooldownRemaining = limitCheck.cooldown_remaining;
            updateAdStatus();
            return;
        }
        
        // Qaysi platformani ko'rsatish kerakligini backend aniqlaydi
        let nextPlatform = limitCheck.next_platform;
        
        if (!nextPlatform) {
            notif(false, 'Bugungi barcha reklama limitlari tugagan');
            return;
        }
        
        // Tugmani vaqtincha o'chirish
        let btn = document.getElementById('watchAdBtn');
        btn.disabled = true;
        
        // Platformalar ro'yxati
        let platformQueue = [];
        
        if (nextPlatform === 'adsgram') {
            platformQueue = ['adsgram', 'sonar', 'telegramads'];
        } else if (nextPlatform === 'sonar') {
            platformQueue = ['sonar', 'telegramads', 'adsgram'];
        } else if (nextPlatform === 'telegramads') {
            platformQueue = ['telegramads', 'sonar', 'adsgram'];
        }
        
        // Navbat bo'yicha reklamalarni ko'rsatishga harakat qilish
        tryShowAd(platformQueue, 0, btn);
    };
    
    // Rekursiv funksiya - agar bitta ishlamasa keyingisiga o'tadi
    async function tryShowAd(platformQueue, index, btn) {
        if (index >= platformQueue.length) {
            notif(false, 'Hech qanday reklama mavjud emas');
            btn.disabled = false;
            return;
        }
        
        let platform = platformQueue[index];
        
        if (platform === 'adsgram') {
            if (AdController) {
                AdController.show().then(async () => {
                    let res = await api('add', { source: 'adsgram' });
                    handleAdResponse(res);
                }).catch((result) => {
                    console.log('Adsgram xatosi, keyingisiga o\'tamiz...');
                    tryShowAd(platformQueue, index + 1, btn);
                });
            } else {
                console.log('Adsgram mavjud emas, keyingisiga o\'tamiz...');
                tryShowAd(platformQueue, index + 1, btn);
            }
        } 
        else if (platform === 'sonar') {
            if (window.Sonar) {
                window.Sonar.show({ 
                    adUnit: "rekchiai", 
                    onReward: async () => {
                        let res = await api('add', { source: 'sonar' });
                        handleAdResponse(res);
                    },
                    onError: (error) => {
                        console.log('Sonar xatosi, keyingisiga o\'tamiz...');
                        tryShowAd(platformQueue, index + 1, btn);
                    }
                });
            } else {
                console.log('Sonar mavjud emas, keyingisiga o\'tamiz...');
                tryShowAd(platformQueue, index + 1, btn);
            }
        }
        else if (platform === 'telegramads') {
            if (window.TelegramAdsController && typeof window.TelegramAdsController.triggerInterstitialBanner === 'function') {
                try {
                    // To'g'ri metod nomi: triggerInterstitialBanner
                    window.TelegramAdsController.triggerInterstitialBanner()
                        .then(async (result) => {
                            console.log('TelegramAds result:', result);
                            // Muvaffaqiyatli ko'rsatildi
                            let res = await api('add', { source: 'telegramads' });
                            handleAdResponse(res);
                        })
                        .catch((error) => {
                            console.log('TelegramAds xatosi, keyingisiga o\'tamiz...', error);
                            // Keyingi platformaga o'tish
                            tryShowAd(platformQueue, index + 1, btn);
                        });
                } catch (error) {
                    console.log('TelegramAds ishlamadi, keyingisiga o\'tamiz...', error);
                    tryShowAd(platformQueue, index + 1, btn);
                }
            } else {
                console.log('TelegramAds mavjud emas, keyingisiga o\'tamiz...');
                tryShowAd(platformQueue, index + 1, btn);
            }
        }
    }
    
    async function handleAdResponse(res) {
        let btn = document.getElementById('watchAdBtn');
        
        if(res.success) { 
            fetchBalance(); 
            notif(true, `+${res.bonus || 1} üíé bonus qo'shildi`);
            
            // Cooldown boshlanishi
            if (res.cooldown_seconds > 0) {
                cooldownRemaining = res.cooldown_seconds;
            }
            
            updateAdStatus();
        } else {
            if (res.cooldown_remaining) {
                cooldownRemaining = res.cooldown_remaining;
            }
            notif(false, res.message);
            updateAdStatus();
        }
        
        btn.disabled = false;
    }

    async function activatePromo() {
        let c = document.getElementById('promoInput').value;
        if(!c) return;
        let res = await api('activate_code', {code: c});
        notif(res.success, res.message);
        if(res.success) document.getElementById('promoInput').value = '';
        fetchBalance();
    }

    function copyRef() { navigator.clipboard.writeText(user.ref); notif(true, 'Nusxalandi'); }
    
    async function loadRefs() {
        let res = await api('get_referrals');
        let h = '';
        if(res.success && res.referrals.length > 0) {
            res.referrals.forEach(r => {
                let safeName = r.username.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                h += `
                <div class="ref-item">
                    <i class="fas fa-user ref-icon"></i>
                    <div class="ref-name">${safeName}</div>
                </div>`;
            });
        } else { 
            h = '<div style="padding:15px; text-align:center; color:#999;">Hali referallar yo\'q</div>'; 
        }
        document.getElementById('refList').innerHTML = h;
    }

    async function loadAdminPromoCodes() {
        let res = await api('admin_get_promos');
        let container = document.getElementById('adminPromoList');
        
        if(res.success && res.promos && res.promos.length > 0) {
            let html = '';
            res.promos.forEach(promo => {
                html += `
                <div class="promo-item">
                    <div class="promo-info">
                        <div class="promo-code">${promo.code}</div>
                        <div class="promo-details">${promo.reward_amount} ${promo.reward_type === 'diamond' ? 'üíé' : 'ü™ô'} | ${promo.current_uses}/${promo.max_uses} foydalanish</div>
                    </div>
                    <button class="delete-promo-btn" onclick="deletePromoCode(${promo.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>`;
            });
            container.innerHTML = html;
        } else {
            container.innerHTML = '<div style="text-align:center; color:#999; padding:10px;">Promokodlar topilmadi</div>';
        }
    }

    async function deletePromoCode(id) {
        if(!confirm('Bu promokodni o\'chirishni tasdiqlaysizmi?')) return;
        let res = await api('admin_delete_promo', {promo_id: id});
        if(res.success) {
            notif(true, 'Promokod o\'chirildi');
            loadAdminPromoCodes();
        } else notif(false, res.message);
    }

    window.openAdmin = async () => {
        document.getElementById('adminModal').style.display='flex';
        
        await loadAdSettings();
        await loadAdStats();
        await loadAdminPromoCodes();
        
        let res = await api('admin_get_channels');
        if(res.success) {
            let h = '';
            res.channels.forEach(c => h += `<div style="display:flex; justify-content:space-between;"><span>${c.channel_name}</span><button onclick="admDelChan(${c.id})" style="color:red">X</button></div>`);
            document.getElementById('admChanList').innerHTML = h;
        }
    };

    async function loadAdSettings() {
        let res = await api('admin_get_ad_settings');
        let container = document.getElementById('adSettingsContainer');
        
        if(res.success && res.settings) {
            let settings = res.settings;
            adSettings = settings;
            
            let cooldownText = settings.cooldown_seconds == 0 ? 'Yo\'q' : settings.cooldown_seconds + ' sekund';
            
            container.innerHTML = `
                <div class="ad-settings-card">
                    <div class="setting-item">
                        <span class="setting-label"><i class="fas fa-gem"></i> Bonus miqdori:</span>
                        <span class="setting-value">${settings.bonus_amount} üíé</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label"><i class="fas fa-chart-bar"></i> Kunlik limit:</span>
                        <span class="setting-value">${settings.daily_limit == 0 ? '‚àû Cheksiz' : settings.daily_limit + ' ta'}</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label"><i class="fas fa-hourglass-half"></i> Cooldown:</span>
                        <span class="setting-value">${cooldownText}</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label"><i class="fas fa-calendar"></i> Sozlangan sana:</span>
                        <span class="setting-value">${new Date(settings.updated_at).toLocaleDateString('uz-UZ')}</span>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label"><i class="fas fa-power-off"></i> Holati:</span>
                        <span class="setting-value" style="color:${settings.is_active ? '#4CAF50' : '#f44336'}">
                            ${settings.is_active ? '‚úÖ Faol' : '‚ùå Nofaol'}
                        </span>
                    </div>
                </div>
            `;
            
            document.getElementById('adminAdBonus').value = settings.bonus_amount;
            document.getElementById('adminAdLimit').value = settings.daily_limit;
            document.getElementById('adminAdCooldown').value = settings.cooldown_seconds || 0;
        } else container.innerHTML = '<p style="color:#999; text-align:center;">Sozlamalar yuklanmadi</p>';
    }
    async function loadAdStats() {
        let res = await api('admin_get_ad_stats');
        let container = document.getElementById('adStatsContainer');
        
        if(res.success) {
            let stats = res.stats;
            container.innerHTML = `
                <div class="stat-box">
                    <div class="stat-value">${stats.today_views || 0}</div>
                    <div class="stat-label">Bugun ko'rilgan</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">${stats.total_views || 0}</div>
                    <div class="stat-label">Jami ko'rishlar</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">${stats.total_bonus || 0}</div>
                    <div class="stat-label">Jami bonus</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">${stats.unique_users || 0}</div>
                    <div class="stat-label">Foydalanuvchi</div>
                </div>
            `;
        }
    }

    async function saveAdSettings() {
        let bonusAmount = parseInt(document.getElementById('adminAdBonus').value);
        let dailyLimit = parseInt(document.getElementById('adminAdLimit').value);
        let cooldownSeconds = parseInt(document.getElementById('adminAdCooldown').value) || 0;
        
        if(!bonusAmount || bonusAmount < 1 || bonusAmount > 100) {
            notif(false, 'Bonus miqdori 1-100 oralig\'ida bo\'lishi kerak');
            return;
        }
        
        if(dailyLimit < 0 || dailyLimit > 100) {
            notif(false, 'Kunlik limit 0-100 oralig\'ida bo\'lishi kerak (0 = cheksiz)');
            return;
        }
        
        if(cooldownSeconds < 0 || cooldownSeconds > 3600) {
            notif(false, 'Cooldown 0-3600 sekund oralig\'ida bo\'lishi kerak');
            return;
        }
        
        let res = await api('admin_update_ad_settings', {
            bonus_amount: bonusAmount,
            daily_limit: dailyLimit,
            cooldown_seconds: cooldownSeconds
        });
        
        if(res.success) {
            notif(true, '‚úÖ Sozlamalar muvaffaqiyatli saqlandi');
            await loadAdSettings();
            await loadAdStats();
            updateAdStatus();
        } else notif(false, res.message);
    }
    async function admAddPromo() {
        let d = { code: document.getElementById('admCode').value, amount: document.getElementById('admAmt').value, type: document.getElementById('admType').value, max_uses: document.getElementById('admMax').value };
        let res = await api('admin_add_promo', d);
        if(res.success) {
            notif(true, 'Promokod yaratildi');
            document.getElementById('admCode').value = '';
            document.getElementById('admAmt').value = '';
            document.getElementById('admMax').value = '';
            loadAdminPromoCodes();
        } else notif(false, res.message);
    }
    
    async function admAddChan() {
        let res = await api('admin_add_channel', {channel_input: document.getElementById('admChanInput').value});
        if(res.success) {
            notif(true, 'Kanal qo\'shildi');
            document.getElementById('admChanInput').value = '';
            window.openAdmin();
        } else notif(false, res.message);
    }
    
    async function admDelChan(id) {
        let res = await api('admin_delete_channel', {db_id: id});
        if(res.success) {
            notif(true, 'Kanal o\'chirildi');
            window.openAdmin();
        } else notif(false, res.message);
    }

    async function checkSubs() {
        let res = await api('check_subs');
        if(!res.success) return;
        if(!res.all_subscribed) {
            let h = '';
            res.channels.forEach(c => {
                let link = c.link.startsWith('http') ? c.link : `https://t.me/${c.link.replace('@','')}`;
                if (!c.is_subscribed) {
                     h += `<a href="${link}" target="_blank" class="submit-btn" style="text-decoration:none; display:flex; justify-content:center; align-items:center; margin-bottom:10px; background:#0088cc;">üì¢ Obuna bo'lish</a>`;
                }
            });
            
            if (h !== '') {
                document.getElementById('subList').innerHTML = h;
                document.getElementById('subModal').style.display='flex';
            } else document.getElementById('subModal').style.display='none';
        } else document.getElementById('subModal').style.display='none';
    }

    function notif(success, msg) {
        let n = document.getElementById('notif');
        n.innerText = msg;
        n.className = success ? 'notification show' : 'notification error show';
        setTimeout(() => n.className = 'notification', 3000);
    }
    
    async function checkNotifs() {
        let res = await api('get_notifications');
        if(res.success && res.notifications) res.notifications.forEach(m => notif(true, m));
    }
    
    function createCoins() {
        const con = document.getElementById('floatingCoins');
        const icons = ['üíé','ü™ô','‚≠ê'];
        for(let i=0; i<15; i++) {
            let el = document.createElement('div');
            el.className = 'coin';
            el.innerText = icons[Math.floor(Math.random()*icons.length)];
            el.style.left = Math.random()*100 + '%';
            el.style.animationDelay = Math.random()*20 + 's';
            con.appendChild(el);
        }
    }

    setInterval(updateAdStatus, 10000);
    
    window.onload = async () => {
        await checkSubs();
        await fetchBalance();
        loadMiners();
        loadRefs();
        createCoins();
        
        // TelegramAds initialization
        setTimeout(() => {
            initTelegramAds();
        }, 2000);
        
        // Intervallarni sozlash
        setInterval(fetchBalance, 10000);
        setInterval(startMiningSimulation, 100);
        setInterval(startMinerTimer, 1000);
        
        // Ad status faqat Earn sahifasida update bo'ladi
        setInterval(() => {
            let earnPage = document.getElementById('earnPage');
            if (earnPage && earnPage.style.display !== 'none') {
                updateAdStatus();
            }
        }, 5000);
        
        // Countdown har doim ishlaydi
        setInterval(updateCountdownTimer, 1000);
    };
</script>
</body>
</html>
